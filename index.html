<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Moodtracker</title>
</head>
<body>
<div>
    <div align="center">
        <button onclick="grabMood(this)" value="1">1: Super Low mood</button>
        <button onclick="grabMood(this)" value="2">2: Low mood</button>
        <button onclick="grabMood(this)" value="3">3: Medium mood</button>
        <button onclick="grabMood(this)" value="4">4: Good mood</button>
        <button onclick="grabMood(this)" value="5">5: AWESOME mood</button>
    </div>

    <div id="Info" align="center">
        <h1 id="instruction">Please click on your mood above</h1>
        <h2 id="currentMood"></h2>

        <!--later, change function to checkSend, with validation etc-->
        <button id="sendButton" onclick="temporary()" hidden>Click here to send your mood to the database</button>
    </div>


    <button onclick="temporary()">MAKE TO JSON</button>

</div>

    <script>

        function temporary(){
            SEND = JSON.stringify(dataToSend);
            console.log("success");
            console.log(dataToSend);
            webSocketConnection(SEND);
            
        }

        //Dictionary to send to the server
        var dataToSend = {"mood": "", "date": "2016-11-06 23:00:25.689784"}

        //takes JSON data from a previously executed function, sends it to server, gets data back
        function webSocketConnection(JSONdata)
        {
            //must add in some parsing checks and stuff... might not be here but... yeah.
            var connection = new WebSocket("ws://mood.gretaparks.com:8080");

            //send data
            //note: event stays.  It is good practice to always match method signatures
            connection.onopen = function (event) {
                connection.send(JSONdata);
                console.log("JSONdata sent");
            }

            //receive a message from server
            connection.onmessage = function (m) {
                console.log("Recieved message from server" + m.data);
                //SEND data to a parser, which will update the site.
                //possibly close connection here: connection.close()
            }
        }

        //grabs mood from HTML, inserts it into JSON string
        function grabMood(buttonObject) {
            //realized THIS!!  Refers to button and that way you can easily access value/other tags
            var x = buttonObject.value;
            console.log("mood entered was", x)
            dataToSend["mood"] = x
            console.log("Current dictionary datatoSend is:")
            console.dir(dataToSend)
            changeText(x)
        }

        //not really necessary as a separate function... but I'm a newbie and I might want to add to this later.
        function changeText(mood) {
            document.getElementById("instruction").innerHTML = "Your mood is:";
            document.getElementById("currentMood").innerHTML = mood;
            document.getElementById("sendButton").style.display = "block";
        }

        //FUNCTIONS TO USE LATER... 

        //!!for later use to parse a return message
        function JSONparser(m) {
            try {
                return JSON.parse(m);
            }
            catch (err) {
                console.log("there was a parsing error" + err)
                // later:         message.innerHTML = "Input is " + err;
            }
            //might be possible to add a finally that would refresh or reset? =x
        }

        //read a message and print.  Will expand later
        function readMessage(m) {
            console.log("message received:" + m)
        }

/*        function checkSend() {
            if dataToSend["mood"] = null
        }
        */

    </script>

</body>
</html>