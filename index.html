<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Moodtracker</title>
</head>
<body>


    <script>

        /* planning for Sanity - functions needed:
            Websocket: open , and send / receive messages
            JSON encoder to SEND to server
            JSON decoder to RECIEVE message
            Message Handler to read message and act upon it
            Later: validation for received inputs

            For html, need to have:
                buttons for input.  
                Later: option to set date time manually
                some type of input to request RECEIPT of data, inc graph/selections for parameters
        */
        function JSONparser(m)
        {
            try {
                return JSON.parse(m); 
            }
            catch (err) {
                console.log("there was a parsing error" + err)
                // later:         message.innerHTML = "Input is " + err;
            }
            //might be possible to add a finally that would refresh or reset? =x
        }

        function readMessage(m)
        {
            console.log("message received:" + m)

        }

        //takes JSON data from a previously executed function, sends it to server, gets data back
        function webSocketConnection(JSONdata)
        {
            var connection = new WebSocket("ws://mood.gretaparks.com:8080");

            //send data
            //note: event stays.  It is good practice to always match method signatures
            connection.onopen = function (event) {
                connection.send(JSONdata);
                console.log("JSONdata sent");
            }

            //receive a message from server
            connection.onmessage = function (m) {
                console.log("Recieved message from server" + m.data);
                //SEND data to a parser, which will update the site.
                //possibly close connection here: connection.close()
            }
        }

        //run stuff:
        data = '{"mood": 4, "date": "2016-11-06 23:00:25.689784"}'
        webSocketConnection(data)

    </script>

</body>
</html>